---
title: "Day 3"
author: "David Kane"
---

## Goal

Start with a Github repository, RStudio project and a new Quarto document. Publish a scatterplot of county size versus economic connectedness to Rpubs.

```{r}
#| echo: false
#| warning: false

library(tidyverse)
library(primer.data)

connectedness |> 
  ggplot(aes(x = population, y = connectedness)) +
    geom_point() +
    scale_x_log10(labels = scales::comma_format()) +
    labs(title = "US County Populations versus Economic Connectedness",
         subtitle = "Population size does not matter to EC",
         x = "Population",
         y = "Economic Connectedness",
         caption = "Opportunity Insights")
```


## Session 1

Start with a Github repo, named class-yyyy-mm-dd. Make sure it is public. Add a README. Connect it to RStudio.  

Send to rooms to create. If you succeeded while I was demonstrating, that is OK! Now help your classmates.

If you have not done the RStudio and Github homework, then this will be really hard. And it is not fair to your classmates! Either catch up this weekend or don't come back on Monday.

## Session 2

Explore files pane. Turn off Show Hidden files.

Check out the Git pane.

Take a look at the .gitignore file.

Add the .Rproj file to the .gitignore. Save it. Note how that cleans up the Git pane. 

Check in your change to the .gitignore. Add a message.

Edit the README. Save it. Check the Git pane. Add the README. Check it in.

Check the website. Where is your change? You need to push it.

Your computer is now fully backed up on the cloud. 

To the rooms to make sure everyone can do this. Extra time? Talk about final projects.

## Session 3

Start a Quarto document, called ec.Rmd. Render to confirm that everything works. Remove the junk. Render.

Check the Git pane. Changes! All ec_files to the .gitignore. Add the qmd and the html. Commit and push. See the new files on the web.

Add code chunk with library(tidyverse) and library(primer.data). Render. Annoying messages! 

Add appropriate options. Don't like messages or code.

```{r}
#| message: false
#| echo: false
library(tidyverse)
library(primer.data)
```

Back to rooms. Make sure everyone has done this. Start thinking about a plot. How can we related population to economic connectedness.


## Session 4

Make a geom_point() plot. Take about log scale on the x axis. How deal with the warnings? Don'


## Session 5

Lead them to create a plot like this


```{r}
#| echo: false
#| warning: false
connectedness |> 
  ggplot(aes(x = population, y = connectedness)) +
    geom_point() +
    scale_x_log10(labels = scales::comma_format()) +
    labs(title = "US County Populations versus Economic Connectedness",
         subtitle = "Population size does not matter to EC",
         x = "Population",
         y = "Economic Connectedness",
         caption = "Opportunity Insights")
```

## Session 6

Publish the plot to rpubs. Looks OK. But it is a little ugly to have the title and, maybe the author, edit the YAML to remove. Re-publish. Add link to class-work. Update .gitignore for rsconnect. Push everything.

Now we are ready to do data science!

## Extra Questions

Add a fitted line to the plot. Is there a relationship?
Restrict the plot to your five favorite states, then facet by state.
Map states to regions of the country, then facet by region.

Calculate the sum of the population by state and the average connectedness for counties in a state. Is there a relationship between state population and average county connectedness?

```{r}
#| echo: false
#| message: false
#| label: make plot

library(primer.data)
library(tidyverse)
connectedness |> 
  drop_na() |> 
  mutate(state = str_replace(location, ".*, ", "")) |> 
  summarise(pop_state = sum(population),
            avg_ec = mean(connectedness),
            .by = state) |> 
  ggplot(aes(x = pop_state, y = avg_ec)) +
    geom_point() +
    geom_smooth(method = "lm", formula = y ~ x, se = FALSE) +
    scale_x_log10(breaks = c(1000000, 10000000),
                  labels = scales::comma_format()) +
    labs(y = "Average County Economic Connectedness",
         x = "State Population",
         title = "Economic Connectedness and Population in US States",
         subtitle = "Biggger states have counties with lower average economic connectedness.")
```

