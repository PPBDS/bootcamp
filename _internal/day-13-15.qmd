---
title: "Day 13 to 15"
execute: 
  echo: false
---

This is not a proper script. Sorry! Instead, it is just a scatch pad with some thoughts on the code we want today.

## Scene 1

Load up the libraries you think we are going to need. Read in the data (nicely). Take a look at the data. 

```{r}
#| message: false
library(tidyverse)
library(brms)
library(tidybayes)

x <- read_csv("data/resume.csv", show_col_types = FALSE)
```

## Scene 2

Fit a **brms** model in which getting a callback is a function of race. Use the bernoulli family since call is a binary variable. Use `cache: true` as a code chunk option. Consider using the `refresh`, `silent` and `seed` arguments. Look at the fitted model.

```{r}
#| cache: true
fit_resume <- brm(formula = call ~ race,
                  data = x,
                  family = bernoulli(),
                  refresh = 0,
                  silent = 2,
                  seed = 9)
```


```{r}
fit_resume
```

## Scene 3

Create draws for the posterior probability of receiving a callback, separately for a resume with a black-coded name and for a resume with a white-coded name. Look at those draws.

```{r}
fit_resume |> 
  add_epred_draws(newdata = tibble(race = c("black", "white")))
```

## Scene 4

Create a plot of the two posteriors.

```{r}
fit_resume |> 
  add_epred_draws(newdata = tibble(race = c("black", "white"))) |> 
  select(race, .epred) |> 
   ggplot(aes(x = .epred, fill = race)) +
    geom_histogram(aes(y = after_stat(count/sum(count))),
                   bins = 100) +
    labs(title = "Posterior for Callback Rates",
         subtitle = "Resumes with white-coded names are much more likely to receive callbacks",
         x = "Probability of Callback",
         fill = "(Likely) Race of\n Name on Resume") +
    theme(
      axis.title.y = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks.y = element_blank(),
      axis.line.y = element_blank()
    ) +
    scale_x_continuous(labels = scales::percent_format())

```




